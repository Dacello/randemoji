{"version":3,"sources":["../src/Tokenizer.js"],"names":["KEY_TAB","KEY_ENTER","KEY_ESC","Tokenizer","placeholder","PropTypes","string","remoteOptionsUrl","queryParam","selectedItems","array","inputClassName","optionListClassName","optionClassName","tokenListClassName","tokenClassName","removeButtonClassName","leaveOpen","bool","getItemValue","func","getOptionComponent","getTokenComponent","getInputName","name","defaultValue","any","type","className","children","node","props","state","ignoreKeyUp","optionItems","item","itemArg","id","map","bind","JSON","stringify","onRemove","refs","input","getDOMNode","onSelect","length","renderToken","renderOption","e","keyCode","isSelectKey","getInput","blur","fetchOptions","setState","clearOptions","setTimeout","xhr","abort","items","rejectItem","getSelectedValues","value","queryData","$","get","done","setOptions","push","focus","arg","renderTokens","onKeyDown","onKeyUp","onBlur","onFocus","renderOptions","React","Component"],"mappings":"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","file":"Tokenizer.js","sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport {reject, uniq, includes} from 'lodash'\n\nconst KEY_TAB = 9\nconst KEY_ENTER = 13\nconst KEY_ESC = 27\n\nexport default class Tokenizer extends React.Component {\n  static get propTypes() {\n    return {\n      placeholder: PropTypes.string,\n      remoteOptionsUrl: PropTypes.string,\n      queryParam: PropTypes.string,\n      selectedItems: PropTypes.array,\n      inputClassName: PropTypes.string,\n      optionListClassName: PropTypes.string,\n      optionClassName: PropTypes.string,\n      tokenListClassName: PropTypes.string,\n      tokenClassName: PropTypes.string,\n      removeButtonClassName: PropTypes.string,\n      leaveOpen: PropTypes.bool,\n      getItemValue: PropTypes.func,\n      getOptionComponent: PropTypes.func,\n      getTokenComponent: PropTypes.func,\n      getInputName: PropTypes.func,\n      name: PropTypes.string,\n      defaultValue: PropTypes.any,\n      type: PropTypes.string,\n      className: PropTypes.string,\n      children: PropTypes.node,\n    }\n  }\n\n  static get defaultProps() {\n    return {\n      placeholder: '',\n      remoteOptionsUrl: null,\n      queryParam: 'q',\n      selectedItems: [],\n      inputClassName: 'RevTokenizer-input',\n      optionListClassName: 'RevTokenizer-options',\n      optionClassName: 'RevTokenizer-option',\n      tokenListClassName: 'RevTokenizer-tokens',\n      tokenClassName: 'RevTokenizer-token',\n      removeButtonClassName: 'RevTokenizer-remove',\n      leaveOpen: false,\n    }\n  }\n\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      ignoreKeyUp: false,\n      optionItems: [],\n      selectedItems: this.props.selectedItems,\n    }\n  }\n\n  // Default is item.id\n  getItemValue(item) {\n    return (this.props.getItemValue || ((itemArg) => itemArg.id))(item)\n  }\n\n  getSelectedValues() {\n    return this.state.selectedItems.map(this.getItemValue.bind(this))\n  }\n\n  // Defaults to whatever getTokenComponent returns\n  getOptionComponent(item) {\n    return (this.props.getOptionComponent || this.getTokenComponent)(item)\n  }\n\n  // Defaults to JSON\n  getTokenComponent(item) {\n    return (this.props.getTokenComponent || JSON.stringify)(item)\n  }\n\n  // Default for <Tokenizer name=\"store[widgets]\" /> is <input name=\"store[widgets][]\" />\n  getInputName(item) {\n    return (this.props.getInputName || (() => `${this.props.name}`))(item)\n  }\n\n  // List item that contains @getTokenComponent(item) and a remove button\n  renderToken(item) {\n    return (\n      <li\n        className={this.props.tokenClassName}\n        key={`token-${this.getItemValue(item)}`}\n      >\n        {this.getTokenComponent(item)}\n        <input\n          type=\"hidden\"\n          name={this.getInputName(item)}\n          value={this.getItemValue(item)}\n          readOnly\n        />\n        <button\n          className={this.props.removeButtonClassName}\n          onClick={() => this.onRemove(item)}\n        >\n          Remove\n        </button>\n      </li>\n    )\n  }\n\n  getInput() {\n    return this.refs.input.getDOMNode() // eslint-disable-line react/no-string-refs\n  }\n\n  // List item that contains @getOptionComponent(item)\n  renderOption(item) {\n    /* eslint-disable jsx-a11y/click-events-have-key-events, jsx-a11y/no-noninteractive-element-interactions */\n    return (\n      <li\n        className={this.props.optionClassName}\n        key={`option-${this.getItemValue(item)}`}\n        onClick={() => this.onSelect(item)}\n      >\n        {this.getOptionComponent(item)}\n      </li>\n    )\n    /* eslint-enable jsx-a11y/click-events-have-key-events, jsx-a11y/no-noninteractive-element-interactions */\n  }\n\n  // Renders a list only if it has items\n  renderTokens() {\n    if (!this.state.selectedItems.length > 0) {\n      return null\n    }\n    return (\n      <ul className={this.props.tokenListClassName}>\n        {this.state.selectedItems.map(this.renderToken.bind(this))}\n      </ul>\n    )\n  }\n\n  // Renders a list only if it has items\n  renderOptions() {\n    if (!this.state.optionItems.length > 0) {\n      return null\n    }\n    return (\n      <ul className={this.props.optionListClassName}>\n        {this.state.optionItems.map(this.renderOption.bind(this))}\n      </ul>\n    )\n  }\n\n  isSelectKey(e) {\n    return e.keyCode === KEY_TAB || e.keyCode === KEY_ENTER\n  }\n\n  onKeyDown(e) {\n    // prevent blur, form submit, etc.\n    // unless there's no text in the box, in which case we don't worry about it\n    return this.state.optionItems.length === 0 || !this.isSelectKey(e)\n  }\n  /* eslint complexity: [2, 4] */\n  onKeyUp(e) {\n    if (this.isSelectKey(e)) {\n      // Select the first item on special keypresses\n      if (this.state.optionItems.length > 0) {\n        this.onSelect(this.state.optionItems[0])\n      }\n    } else if (e.keyCode === KEY_ESC) {\n      // Esc to make the option go away\n      this.getInput().blur()\n    } else {\n      this.fetchOptions()\n    }\n\n    this.setState({\n      ignoreKeyUp: false,\n    })\n  }\n\n  onBlur() {\n    const clearOptions = () => this.setState({optionItems: []})\n\n    if (this.props.leaveOpen) {\n      return\n    }\n    // If you don't delay this a little you can't click any of the options\n    setTimeout(clearOptions, 200)\n  }\n\n  onFocus() {\n    this.fetchOptions()\n  }\n\n  clearOptions() {\n    if (this.xhr !== null) {\n      this.xhr.abort()\n    }\n    this.setState({optionItems: []})\n  }\n\n  setOptions(items) {\n    const rejectItem = (item) =>\n      includes(this.getSelectedValues(), this.getItemValue(item))\n\n    this.setState({\n      optionItems: reject(items, rejectItem),\n    })\n  }\n\n  fetchOptions() {\n    if (this.getInput().value === '') {\n      this.clearOptions()\n    } else {\n      const queryData = {}\n\n      queryData[this.props.queryParam] = this.getInput().value\n      this.xhr = $.get(this.props.remoteOptionsUrl, queryData)\n      this.xhr.done(this.setOptions.bind(this))\n    }\n  }\n\n  onSelect(item) {\n    let items = this.state.selectedItems\n    const input = this.getInput()\n\n    items.push(item)\n    items = uniq(items, null, this.getItemValue.bind(this))\n    input.value = ''\n    input.focus()\n    this.clearOptions()\n    this.setState({selectedItems: items})\n    return false\n  }\n\n  onRemove(item) {\n    const items = reject(\n      this.state.selectedItems,\n      (arg) => this.getItemValue(arg) === this.getItemValue(item)\n    )\n\n    this.setState({selectedItems: items})\n    return false\n  }\n\n  render() {\n    return (\n      <div>\n        {this.renderTokens()}\n        <div className={this.props.className}>\n          <input\n            ref=\"input\" // eslint-disable-line react/no-string-refs\n            type={this.props.type || 'text'}\n            className={this.props.inputClassName}\n            placeholder={this.props.placeholder}\n            defaultValue={this.props.defaultValue}\n            onKeyDown={this.onKeyDown.bind(this)}\n            onKeyUp={this.onKeyUp.bind(this)}\n            onBlur={this.onBlur.bind(this)}\n            onFocus={this.onFocus.bind(this)}\n          />\n          {this.props.children}\n        </div>\n        {this.renderOptions()}\n      </div>\n    )\n  }\n}\n"]}